# Docker Security Справочник

## Управление правами доступа

### Создание группы docker

```bash
sudo groupadd docker
```

| Команда / Инструкция | Категория | Описание |
|----------------------|-----------|----------|
| groupadd | Linux | Команда создания новой группы |
| docker | Аргумент | Имя создаваемой группы |

---

### Добавление пользователя в группу docker

```bash
sudo usermod -aG docker $USER
```

| Команда / Инструкция | Категория | Описание |
|----------------------|-----------|----------|
| usermod | Linux | Команда изменения учётной записи пользователя |
| -aG | Флаг | -a — добавить, -G — указание группы |
| $USER | Переменная | Имя текущего пользователя |

---

### Изменение владельца сокета Docker

```bash
sudo chown root:docker /var/run/docker.sock
```

| Команда / Инструкция | Категория | Описание |
|----------------------|-----------|----------|
| chown | Linux | Изменение владельца и группы файла |
| root:docker | Аргумент | Новый владелец (`root`) и группа (`docker`) |
| /var/run/docker.sock | Путь | Unix-сокет Docker |

---

### Изменение прав доступа к сокету Docker

```bash
sudo chmod 660 /var/run/docker.sock
```

| Команда / Инструкция | Категория | Описание |
|----------------------|-----------|----------|
| chmod | Linux | Изменение прав доступа |
| 660 | Права | Владелец: чтение+запись, группа: чтение+запись, остальные: нет прав |
| /var/run/docker.sock | Путь | Unix-сокет Docker |

---

## Сканирование уязвимостей

### Сканирование образа Trivy

```bash
trivy image <your_image_name>
```

| Команда / Инструкция | Категория | Описание |
|----------------------|-----------|----------|
| trivy | Security Tool | CLI-инструмент для сканирования уязвимостей |
| image | Подкоманда | Работа с Docker-образами |
| <your_image_name> | Аргумент | Имя сканируемого образа (например, `nginx:latest`) |

---

### Анализ результатов

| Действие | Категория | Описание |
|----------|-----------|----------|
| Анализ отчета | Security | Проверка найденных уязвимостей |
| Обновление | Dockerfile | Замена базового образа или обновление пакетов |

---

## Команды для работы с безопасностью Docker

| Команда / Инструкция | Категория | Описание |
|----------------------|-----------|----------|
| docker info | Docker | Общая информация, включая параметры безопасности |
| docker system df | Docker | Использование диска и неиспользуемые ресурсы |
| docker image prune -a | Docker | Удаление всех неиспользуемых образов |
| docker scan <image> | Docker Security | Сканирование образа на уязвимости (Docker Scout) |
| docker trust inspect <image> | Docker Security | Проверка информации о подписи образа |
| docker logout <registry> | Docker Security | Выход из реестра и очистка учётных данных |

---

## Инструменты для анализа безопасности Docker

| Инструмент | Категория | Описание |
|------------|-----------|----------|
| Trivy | Security Tool | Сканер уязвимостей для контейнеров, файловых систем и Git-репозиториев |
| Clair | Security Tool | Статический анализ уязвимостей в контейнерах |
| Anchore Engine | Security Tool | Глубокий анализ образов и проверка политик |
| Grype | Security Tool | Сканер уязвимостей от Anchore |
| Snyk | Security Tool | Коммерческая платформа для сканирования кода и контейнеров |
| Falco | Security Tool | Runtime-система безопасности, выявляющая аномалии |
| Docker Bench for Security | Security Tool | Проверка конфигурации хоста на соответствие best practices |
| Notary | Security Tool | Подписание и проверка цифровых подписей образов |

