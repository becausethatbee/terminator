# Справочник по Docker

---

## Основные команды Docker

```bash
docker ps
```

| Команда    | Описание                                      |
|------------|-----------------------------------------------|
| docker ps  | Список работающих контейнеров                 |

```bash
docker ps -a
```

| Команда       | Описание                              |
|---------------|---------------------------------------|
| docker ps -a  | Список всех контейнеров (включая остановленные) |

```bash
docker images
```

| Команда       | Описание                   |
|---------------|----------------------------|
| docker images | Список локальных образов   |

```bash
docker pull <image>
```

| Команда        | Описание                           |
|----------------|------------------------------------|
| docker pull    | Скачать образ из Docker Hub        |
| <image>        | Имя образа (например, nginx:latest)|

```bash
docker rmi <image_id>
```

| Команда        | Описание                     |
|----------------|------------------------------|
| docker rmi     | Удалить образ                |
| <image_id>     | ID или имя образа            |

```bash
docker rm <container_id>
```

| Команда        | Описание                       |
|----------------|--------------------------------|
| docker rm      | Удалить контейнер              |
| <container_id> | ID контейнера                  |

```bash
docker stop <container_id>
```

| Команда         | Описание                           |
|-----------------|------------------------------------|
| docker stop     | Остановить работающий контейнер    |

```bash
docker start <container_id>
```

| Команда          | Описание                      |
|------------------|-------------------------------|
| docker start     | Запустить остановленный контейнер |

```bash
docker exec -it <container_id> /bin/bash
```

| Команда           | Описание                                      |
|-------------------|-----------------------------------------------|
| docker exec -it   | Выполнить команду в контейнере (интерактивно) |
| /bin/bash         | Запустить оболочку внутри контейнера          |

```bash
docker logs -f <container_id>
```

| Команда          | Описание                           |
|------------------|------------------------------------|
| docker logs -f   | Просмотр логов контейнера в реальном времени |

---

## Флаги `docker run`

```bash
docker run [OPTIONS] <image>
```

| Флаг / Опция    | Описание                                                                 |
|-----------------|--------------------------------------------------------------------------|
| -d              | Запуск контейнера в фоне (detached)                                      |
| -it             | Интерактивный режим с терминалом                                         |
| --name NAME     | Установить имя контейнера                                                |
| --rm            | Автоматически удалить контейнер после остановки                          |
| --restart=...   | Автоматический перезапуск (`no`, `always`, `on-failure`, `unless-stopped`)|
| -p HOST:CONT    | Проброс портов (например, `8080:80`)                                     |
| -v HOST:CONT    | Примонтировать директорию или том                                        |
| --mount ...     | Более гибкая альтернатива `-v`                                          |
| -e VAR=VAL      | Установить переменную окружения                                          |
| --env-file FILE | Подгрузить переменные окружения из файла                                |
| -m 512m         | Ограничить память контейнера                                             |
| --cpus=1.5      | Ограничить количество CPU                                                |
| --network=...   | Подключить к сети (`bridge`, `host`, `none`, пользовательская)           |
| -u UID:GID      | Запустить от имени пользователя                                          |
| -w PATH         | Рабочая директория контейнера                                            |
| --entrypoint ...| Переопределить точку входа                                               |
| --privileged    | Дать контейнеру расширенные привилегии                                   |
| --hostname NAME | Установить hostname контейнера                                           |

---

## Примеры `docker run`

```bash
# Запустить Nginx на 8080 порту
docker run -d -p 8080:80 nginx

# Запустить контейнер с именем myapp и переменной окружения
docker run -d --name myapp -e ENV=prod nginx

# Примонтировать директорию
docker run -d -v /home/user/data:/app/data nginx

# Ограничить ресурсы
docker run -d -m 512m --cpus=1.5 nginx
```

---

## Docker Compose

### Основные команды

```bash
docker-compose up -d
```

| Команда                   | Описание                                      |
|----------------------------|-----------------------------------------------|
| docker-compose up -d       | Запуск сервисов в фоне                       |

```bash
docker-compose down
```

| Команда                   | Описание                           |
|----------------------------|------------------------------------|
| docker-compose down        | Остановить и удалить сервисы       |

```bash
docker-compose ps
```

| Команда                   | Описание                   |
|----------------------------|----------------------------|
| docker-compose ps          | Список контейнеров в проекте |

```bash
docker-compose logs -f
```

| Команда                   | Описание                                |
|----------------------------|-----------------------------------------|
| docker-compose logs -f     | Просмотр логов всех сервисов в реальном времени |

```bash
docker-compose exec <service> bash
```

| Команда                                | Описание                      |
|----------------------------------------|-------------------------------|
| docker-compose exec <service> bash     | Войти в контейнер сервиса     |

---

### Пример `docker-compose.yml`

```yaml
version: '3.9'

services:
  web:
    image: nginx:latest
    ports:
      - "8080:80"
    volumes:
      - ./html:/usr/share/nginx/html
    restart: always

  app:
    image: python:3.11
    working_dir: /app
    volumes:
      - ./app:/app
    command: python app.py
    restart: unless-stopped

  db:
    image: postgres:15
    environment:
      POSTGRES_USER: user
      POSTGRES_PASSWORD: pass
      POSTGRES_DB: mydb
    volumes:
      - db_data:/var/lib/postgresql/data
    restart: on-failure

volumes:
  db_data:
```

---
